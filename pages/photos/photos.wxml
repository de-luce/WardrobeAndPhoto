<!--pages/photos/photos.wxml-->
<view class="photos-container">
  <!-- é¡¶éƒ¨æ·»åŠ æŒ‰é’® -->
  <view class="header">
    <view class="add-btn" bindtap="choosePhotos">
      <text class="add-icon">+</text>
      <text>æ·»åŠ ç…§ç‰‡</text>
    </view>
  </view>

  <!-- æ‹ç«‹å¾—ç…§ç‰‡å¢™ - å åŠ æ»‘åŠ¨ -->
  <view class="photos-wall-container">
    <swiper 
      class="photos-swiper"
      indicator-dots="{{false}}"
      circular="{{photoList.length > 1}}"
      bindchange="onSwiperChange"
      current="{{currentIndex}}"
      duration="300"
    >
      <swiper-item 
        wx:for="{{photoList}}" 
        wx:key="id"
        class="swiper-item-wrapper"
      >
        <!-- å åŠ çš„ç…§ç‰‡å † -->
        <view class="stack-container">
          <!-- åé¢çš„ç…§ç‰‡ï¼ˆæ˜¾ç¤ºåœ¨åº•éƒ¨ä½œä¸ºé¢„è§ˆï¼‰ -->
          <view 
            wx:for="{{photoList}}" 
            wx:for-item="stackItem"
            wx:for-index="stackIndex"
            wx:key="stackItem.id"
            wx:if="{{stackIndex > index && stackIndex <= index + 2}}"
            class="polaroid-item stack-item behind" 
            style="z-index: {{stackIndex - index}}; transform: translate(-50%, -50%) rotate({{stackItem.rotate || 0}}deg) translate({{(stackIndex - index) * 12}}rpx, {{(stackIndex - index) * 12}}rpx) scale({{1 - (stackIndex - index) * 0.08}}); opacity: {{0.6 - (stackIndex - index) * 0.2}};"
          >
            <view class="polaroid-photo">
              <image class="polaroid-image" src="{{stackItem.imageUrl}}" mode="aspectFill" lazy-load="{{false}}"></image>
            </view>
            <view class="polaroid-label">
              <text class="label-text" wx:if="{{stackItem.description}}">{{stackItem.description}}</text>
              <text class="label-date" wx:if="{{!stackItem.description}}">{{stackItem.displayDate || ''}}</text>
            </view>
          </view>
          
          <!-- å½“å‰ç…§ç‰‡ -->
          <view 
            class="polaroid-item stack-item current" 
            style="z-index: 10; transform: translate(-50%, -50%) rotate({{item.rotate || 0}}deg);"
          >
            <!-- æ‹ç«‹å¾—ç…§ç‰‡ä¸»ä½“ -->
            <view class="polaroid-photo" bindtap="previewImage" data-url="{{item.imageUrl}}" data-index="{{index}}">
              <image class="polaroid-image" src="{{item.imageUrl}}" mode="aspectFill" lazy-load="{{false}}"></image>
            </view>
            <!-- åº•éƒ¨æ ‡ç­¾åŒºåŸŸ -->
            <view class="polaroid-label">
              <text class="label-text" wx:if="{{item.description}}">{{item.description}}</text>
              <text class="label-date" wx:if="{{!item.description}}">{{item.displayDate || ''}}</text>
            </view>
            <!-- æ“ä½œæŒ‰é’® -->
            <view class="polaroid-actions">
              <view class="action-icon delete-icon" catchtap="deletePhoto" data-id="{{item.id}}">ğŸ—‘ï¸</view>
            </view>
          </view>
        </view>
      </swiper-item>
    </swiper>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{photoList.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“·</text>
      <text class="empty-text">ç…§ç‰‡å¢™è¿˜æ˜¯ç©ºçš„ï¼Œå¿«æ¥æ·»åŠ ç¬¬ä¸€å¼ ç…§ç‰‡å§~</text>
    </view>
    
    <!-- ç…§ç‰‡æŒ‡ç¤ºå™¨ -->
    <view wx:if="{{photoList.length > 1}}" class="photo-indicator">
      <text class="indicator-text">{{currentIndex + 1}} / {{photoList.length}}</text>
    </view>
  </view>
</view>

